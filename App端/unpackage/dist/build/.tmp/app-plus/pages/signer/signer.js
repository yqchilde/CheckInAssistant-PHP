(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/signer/signer"],{"0925":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return a})},4334:function(t,e,n){"use strict";n.r(e);var i=n("9728"),a=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);e["default"]=a.a},"5a2b":function(t,e,n){"use strict";n.r(e);var i=n("0925"),a=n("4334");for(var o in a)"default"!==o&&function(t){n.d(e,t,function(){return a[t]})}(o);n("9086");var s=n("2877"),u=Object(s["a"])(a["default"],i["a"],i["b"],!1,null,null,null);e["default"]=u.exports},9086:function(t,e,n){"use strict";var i=n("ecda"),a=n.n(i);a.a},9728:function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,o=u(n("95d1")),s=u(n("0a0c"));function u(t){return t&&t.__esModule?t:{default:t}}var r=function(){return n.e("components/number-box").then(n.bind(null,"8916"))},d=function(){return n.e("components/uni-notice-bar/uni-notice-bar").then(n.bind(null,"9ffd"))},c={components:{numberBox:r,uniNoticeBar:d},data:function(){return{uName:"",roomName:"",times:"",signInWay:"",signInWayTxt:"",signCode:"",totalTime:0,recordingTime:0,currentTime:0,timeOut:"",openMode:"",signId:"",codeSign:"",inputCode:"",signStatus:0,dizhi:"",latitude:0,longitude:0,rangeTxt:"",covers:[{latitude:0,longitude:0,iconPath:"./static/images/inc/location.png"}]}},onLoad:function(e){var n=this;a=this,t.showLoading({title:"加载中..."}),this.signId=e.signId,this.openMode=e.openMode,setTimeout(function(t){n.getSignInfo(n.signId)},1e3)},methods:{getCode:function(t){this.inputCode=t},checking:function(){this.currentTime=this.totalTime,this.checkingTime()},checkingTime:function(){clearTimeout(this.timeOut),this.currentTime>0&&this.recordingTime<=this.totalTime?(this.recordingTime=this.recordingTime+1,this.currentTime=this.totalTime-this.recordingTime,this.timeOut=setTimeout(function(){a.checkingTime()},1e3)):(this.recordingTime=0,1==this.signStatus?this.signStatus=3:3==this.signStatus?this.signStatus:this.signStatus=2)},getSignInfo:function(e){var n=this,i=t.getStorageSync("USERID");t.request({url:a.apiServer+"sign&m=getSignInfo",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{signId:e,userId:i},success:function(e){e=e.data,n.roomName=e.data.roomName,n.uName=e.data.uName,n.signStatus=e.data.signStatus;var i=o.default.timestampToTime(e.data.beginTime,2),s=o.default.timestampToTime(e.data.beginTime,3),u=o.default.timestampToTime(e.data.signTime,3);switch(n.times=i+""+s+"-"+u,n.totalTime=parseInt(e.data.signTime-Math.floor(new Date/1e3)),n.checking(),t.hideLoading(),e.data.signInWay){case"code":n.signInWay="code",n.signInWayTxt="签到码";var r=e.data.signCode;n.codeSign=r;var d,c=/\d{1}/g,g=new Array;while(null!=(d=c.exec(r)))g.push(d[0]);n.signCode=g;break;case"gps":n.signInWay="gps",n.signInWayTxt="GPS",n.latitude=e.data.latitude,n.longitude=e.data.longitude;var l=new plus.maps.Point(e.data.longitude,e.data.latitude);plus.maps.Map.reverseGeocode(l,{},function(t){var e=t.address;t.coord,t.coordType;a.dizhi="目标地点："+e}),n.covers[0].latitude=e.data.latitude,n.covers[0].longitude=e.data.longitude,n.refreshRange();break;case"face":n.signInWay="face",n.signInWayTxt="人脸";break;default:break}}})},toSignIn:function(e){var n=this.signInWay;switch(n){case"code":if(this.inputCode!==this.codeSign)return void t.showToast({title:"签到码错误",icon:"none"});this.signOrder(e);break;case"gps":this.signOrder(e);break;case"face":break;default:break}},signOrder:function(e){var n=this,i=t.getStorageSync("USERID");t.request({url:a.apiServer+"sign&m=toSignIn",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{signId:e,userId:i},success:function(e){e=e.data,"error"==e.status?t.showToast({title:e.data,icon:"none"}):"ok"==e.status&&"签到成功"==e.data&&(t.showToast({title:e.data,icon:"none"}),n.signStatus=1)}})},viewSign:function(e){t.navigateTo({url:"../viewSign/viewSign?signId="+e})},computedDt:function(t,e){var n=new s.default.LngLat(this.longitude,this.latitude),i=new s.default.LngLat(t,e),a=s.default.calculateLineDistance(n,i);return a},refreshRange:function(){var e=this;t.showLoading({title:"正在计算距离中..."}),setTimeout(function(n){t.getLocation({type:"gcj02",success:function(n){var a=e.computedDt(n.longitude,n.latitude);a<=50?e.rangeTxt="当前已进入签到范围内(50米)":(e.rangeTxt="当前未进入签到范围",console.log(i(e.signStatus," at pages\\signer\\signer.vue:353")),3!=e.signStatus&&(e.signStatus=4),e.checking()),t.hideLoading()}})},500)}}};e.default=c}).call(this,n("6e42")["default"],n("0de9")["default"])},ecda:function(t,e,n){}},[["76a6","common/runtime","common/vendor"]]]);